pipeline {
    agent any

    tools {
        maven 'maven_3_5_2' // Assurez-vous que cette configuration correspond bien à votre instance Jenkins
    }

    stages {
        stage('Run SAST Scan') { // Correction de la syntaxe pour l'étape SAST
            steps {
                sh '''
                mvn clean verify sonar:sonar \
                  -Dsonar.projectKey=demo-proj \
                  -Dsonar.organization=demo-sast \
                  -Dsonar.host.url=https://sonarcloud.io
                '''
            }
        }

        stage('Run SCA Scan') {
            steps {
                withCredentials([string(credentialsId: 'SNYK_TOKEN', variable: 'SNYK_TOKEN')]) {
                    sh '''
                    snyk auth $SNYK_TOKEN
                    snyk test --severity-threshold=high
                    '''
                }
            }
        }
    }
}
